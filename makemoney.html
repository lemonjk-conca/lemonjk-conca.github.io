<!DOCTYPE html>
<html lang="vi">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Make Money - Full Edition (Clicker + Casino + Upgrades)</title>
  <style>
    :root{
      --bg:#f6f5ff;
      --card:#ffffff;
      --accent:#6a4cff;
      --accent-2:#ff6a95;
      --muted:#666;
      --win:#2ecc71;
      --lose:#e74c3c;
      --danger:#c0392b;
    }
    *{box-sizing:border-box}
    body{
      margin:0;
      font-family: "Segoe UI", Roboto, Arial, sans-serif;
      background: linear-gradient(180deg,#f7f5ff,#fff0f7);
      display:flex;
      justify-content:center;
      padding:18px;
      color:#222;
    }
    .app{
      width:1000px;
      max-width:98%;
      background:var(--card);
      border-radius:12px;
      box-shadow:0 12px 34px rgba(100,80,160,0.08);
      padding:18px;
    }
    header{ text-align:center; margin-bottom:8px; }
    header h1{ margin:6px 0; color:var(--accent); font-size:34px; }
    nav{ display:flex; gap:8px; justify-content:center; margin:10px 0; flex-wrap:wrap; }
    nav button{ padding:8px 12px; border-radius:6px; border:1px solid #ddd; background:#fff; cursor:pointer; }
    nav button.active{ background:var(--accent); color:#fff; border-color:var(--accent); }

    .top-row{ display:flex; gap:16px; align-items:center; justify-content:space-between; flex-wrap:wrap; }
    .balance-card{ background:linear-gradient(90deg,#fff,#fff9ff); border-radius:10px; padding:14px; min-width:260px; box-shadow:0 6px 14px rgba(100,80,160,0.04); text-align:center; }
    .balance-card h2{ margin:0; font-size:16px; color:var(--muted); }
    .balance{ font-size:28px; color:var(--accent-2); font-weight:800; margin-top:6px; }

    .main-area{ margin-top:12px; min-height:420px; padding:12px; border-radius:10px; }

    /* money clicker */
    .money { text-align:center; padding:6px; }
    #moneyBtn{ margin-top:8px; width:180px; height:180px; background:linear-gradient(180deg,#ff9ad0,#ff6a95); border:none; border-radius:50%; color:white; font-size:26px; font-weight:800; box-shadow:0 12px 30px rgba(255,106,149,0.22); cursor:pointer; }
    #moneyBtn:active{ transform:translateY(2px); }

    .stats{ display:flex; gap:10px; justify-content:center; margin-top:12px; color:var(--muted); flex-wrap:wrap; }
    .small { background:#f0f0f0; border:1px solid #e0e0e0; padding:8px 10px; border-radius:8px; cursor:pointer; }

    /* casino */
    .casino { text-align:center; padding:8px; }
    .slots { display:flex; gap:10px; justify-content:center; margin:10px 0; }
    .slot { width:92px; height:92px; border:2px solid #222; border-radius:10px; display:flex; align-items:center; justify-content:center; font-size:44px; background:linear-gradient(180deg,#fff,#f2f2f2); transition: all 220ms ease; }
    .slot.win { box-shadow: 0 0 22px 6px rgba(46,204,113,0.16); transform: scale(1.08); }
    .slot.lose { box-shadow: 0 0 18px 4px rgba(231,76,60,0.12); transform: scale(0.98); }
    .slots.shake { animation: shake 650ms ease; }
    @keyframes shake { 10%{ transform:translateX(-6px); } 30%{transform:translateX(6px);} 50%{transform:translateX(-4px);} 70%{transform:translateX(4px);} 90%{transform:translateX(-2px);} 100%{transform:translateX(0);} }

    .casino-controls{ display:flex; gap:8px; justify-content:center; margin-top:10px; flex-wrap:wrap; }
    input[type="number"]{ width:140px; padding:8px; border-radius:6px; border:1px solid #ccc; text-align:center; font-size:16px; }

    /* shop */
    .shop-grid{ display:grid; grid-template-columns:repeat(2,1fr); gap:12px; margin-top:8px; }
    .item{ border-radius:10px; padding:12px; background:linear-gradient(180deg,#fff,#fff6fb); border:1px solid rgba(100,80,160,0.06); }
    .item button{ background:var(--accent); color:white; border:none; padding:8px 10px; border-radius:8px; cursor:pointer; font-weight:700; }

    .ability{ margin-top:12px; display:flex; gap:8px; justify-content:center; align-items:center; flex-wrap:wrap; }

    footer{ margin-top:14px; text-align:center; color:var(--muted); font-size:13px; }

    @media (max-width:820px){
      .top-row{ flex-direction:column; }
      .slots{ gap:6px; }
      .slot{ width:72px; height:72px; font-size:34px; }
      #moneyBtn{ width:150px; height:150px; }
      .shop-grid{ grid-template-columns:1fr; }
    }
  </style>
</head>
<body>
  <div class="app" role="application" aria-label="Make Money Full Game">
    <header>
      <h1>Make Money ‚Äî Full Edition</h1>
      <div style="color:var(--muted)">Clicker + Shop + Casino (emoji slots) + Sound + Abilities + Persistence</div>
    </header>

    <nav>
      <button id="tabMoney" class="active">Money</button>
      <button id="tabIncome">Income</button>
      <button id="tabUpgrades">Upgrades</button>
      <button id="tabCasino">Casino</button>
      <button id="tabHelp">Help</button>
    </nav>

    <div class="top-row">
      <div class="balance-card" aria-live="polite">
        <h2>S·ªë d∆∞</h2>
        <div class="balance" id="balance">0 ‚Ç´</div>
        <div style="margin-top:6px; font-size:13px; color:var(--muted)" id="perClick">Click: 1 ‚Ç´</div>
      </div>

      <div style="flex:1; min-width:280px; text-align:center;">
        <div style="font-size:13px; color:var(--muted)">T·ªïng ki·∫øm ƒë∆∞·ª£c: <span id="totalEarned">0</span></div>
        <div style="margin-top:8px" class="ability">
          <button id="saveBtn" class="small">L∆∞u</button>
          <button id="resetBtn" class="small">Reset</button>
          <button id="exportBtn" class="small">Export Save</button>
          <button id="importBtn" class="small">Import Save</button>
        </div>
      </div>
    </div>

    <div class="main-area">
      <!-- MONEY -->
      <section id="moneyTab" style="display:block" class="money">
        <div style="font-size:15px; color:var(--muted)">Income hi·ªán t·∫°i: <span id="incomeLabel">$1</span></div>
        <div style="margin-top:6px; font-size:18px; font-weight:700">Money:</div>
        <div style="font-size:40px; font-weight:800; margin-top:6px" id="bigMoney">$0</div>
        <p id="brokeText" style="color:var(--muted); font-style:italic; margin-top:8px">You are broke!</p>

        <button id="moneyBtn">Earn</button>

        <div class="stats">
          <div>Auto: <span id="autoRate">0</span>/s</div>
          <div>Bonus Clicks: <span id="bonusClicks">0</span></div>
          <div>BigBet: <span id="bigBetLabel">OFF</span></div>
        </div>
      </section>

      <!-- INCOME DETAILS -->
      <section id="incomeTab" style="display:none; padding:8px;">
        <h3>Income</h3>
        <p>Per-click: <strong id="infoPerClick">1</strong> ‚Ç´</p>
        <p>Auto per second: <strong id="infoAuto">0</strong> ‚Ç´/s</p>
        <p>Total earned: <strong id="infoTotal">0</strong></p>
      </section>

      <!-- UPGRADES -->
      <section id="upgradesTab" style="display:none; padding:8px;">
        <h3>Upgrades</h3>
        <div class="shop-grid" id="shopGrid"></div>
        <div style="margin-top:12px;">
          <h4>Abilities</h4>
          <div class="ability">
            <div>
              <button id="activateBigBet" class="small">K√≠ch ho·∫°t Big Bet</button>
              <div style="font-size:13px; color:var(--muted)">Big Bet: t·∫°m th·ªùi x2 payout, th·ªùi gian 20s, cooldown 60s, ph√≠ 200</div>
            </div>
            <div>
              <button id="purchaseMega" class="small">Mua Mega Jackpot (1 level)</button>
              <div style="font-size:13px; color:var(--muted)">Mega Jackpot: tƒÉng multiplier triple and special 7 payout</div>
            </div>
          </div>
        </div>
      </section>

      <!-- CASINO -->
      <section id="casinoTab" style="display:none" class="casino">
        <h3>Casino - Slots</h3>
        <div style="margin-top:6px; font-weight:700">Money: <span id="casinoMoney">$0</span></div>

        <div class="slots" id="slotsContainer" aria-hidden="false">
          <div class="slot" id="slot1">üçí</div>
          <div class="slot" id="slot2">üçí</div>
          <div class="slot" id="slot3">üçí</div>
        </div>

        <div class="casino-controls">
          <input id="betInput" type="number" min="1" placeholder="Nh·∫≠p ti·ªÅn c∆∞·ª£c" />
          <button id="maxBetBtn" class="small">Max</button>
          <button id="gambleBtn" class="small">GAMBLE</button>
        </div>

        <div class="casino-info" id="casinoInfo" style="margin-top:8px; color:var(--muted)">Quy t·∫Øc: 3 gi·ªëng -> l·ªõn, 2 gi·ªëng -> nh·ªè. C√≥ th·ªÉ mua boosts trong c·ª≠a h√†ng.</div>

        <div style="margin-top:10px;">
          <button id="casinoBack" class="small">Back</button>
        </div>
      </section>

      <!-- HELP -->
      <section id="helpTab" style="display:none; padding:8px;">
        <h3>Help</h3>
        <ul>
          <li>B·∫•m Earn ƒë·ªÉ ki·∫øm ti·ªÅn (per click tƒÉng khi mua Click Power).</li>
          <li>Auto Worker ki·∫øm ti·ªÅn m·ªói gi√¢y.</li>
          <li>Shop c√≥: Click Power, Auto Worker, Casino Boost (tƒÉng payout), Mega Jackpot (tƒÉng payout m·∫°nh, 7 special), v.v.</li>
          <li>Casino: ƒë·∫∑t c∆∞·ª£c, nh·∫•n GAMBLE. Bet s·∫Ω b·ªã tr·ª´ tr∆∞·ªõc, th·∫Øng ƒë∆∞·ª£c tr·∫£ theo multiplier.</li>
          <li>Big Bet: k√≠ch ho·∫°t t·∫°m th·ªùi tƒÉng payout (c·∫ßn ph√≠), c√≥ cooldown.</li>
          <li>D·ªØ li·ªáu l∆∞u localStorage; d√πng Export/Import ƒë·ªÉ sao l∆∞u.</li>
        </ul>
      </section>
    </div>

    <footer>Full demo cho l·ªõp 12 ‚Äî bao g·ªìm √¢m thanh, animation, l∆∞u tr·ªØ. B·∫°n c√≥ th·ªÉ ch·ªânh s·ªë trong ph·∫ßn "ch·ªânh payout" trong m√£.</footer>
  </div>

  <script>
    /* =============================
       MAKE MONEY - FULL IMPLEMENTATION
       Features included:
       - Clicker (per click, auto per sec)
       - Shop with upgrades: clickPower, autoWorker, casinoBoost, megaJackpot
       - Abilities: Big Bet (active ability), Purchase Mega Jackpot levels
       - Casino: emoji slots, weighted symbols, payout multipliers, special triple 7
       - Sound effects (WebAudio)
       - Visual win/lose effects
       - Persistence (localStorage) + Export/Import
    ================================ */

    // ===== Settings: ch·ªânh payout / behavior ·ªü ƒë√¢y =====
    const SAVE_KEY = "mmg_full_save_v1";
    const SYMBOLS = ['üçí','üçã','‚≠ê','üîî','üçá','7Ô∏è‚É£'];
    // Base multipliers
    const BASE_TRIPLE = 12;  // base triple multiplier
    const BASE_PAIR = 3;     // base pair multiplier
    const MAX_BET_GLOBAL = 100000; // gi·ªõi h·∫°n c∆∞·ª£c t·ªëi ƒëa
    // Big Bet ability config
    const BIG_BET_COST = 200;
    const BIG_BET_MULT = 2;    // x2 payouts
    const BIG_BET_DUR = 20;    // seconds
    const BIG_BET_CD = 60;     // cooldown seconds
    // Mega Jackpot config (can be purchased per level via shop)
    const MEGA_7_BONUS = 3;    // triple 7 multiplies base triple by this factor

    // ===== Game state =====
    let state = {
      balance: 500, // give player some starting money for testing
      perClick: 1,
      autoPerSec: 0,
      totalEarned: 0,
      upgrades: {
        clickPower: 0,
        autoWorker: 0,
        casinoBoost: 0,
        megaJackpot: 0
      },
      bigBet: {
        active: false,
        cooldownUntil: 0,
        activeUntil: 0
      }
    };

    // Shop definitions
    const SHOP = [
      { id: 'clickPower', name: 'Click Power', basePrice: 25, priceMul: 1.8, desc: '+1 per click each level' },
      { id: 'autoWorker', name: 'Auto Worker', basePrice: 50, priceMul: 2.2, desc: '+2 per second each level' },
      { id: 'casinoBoost', name: 'Casino Boost', basePrice: 200, priceMul: 2.5, desc: 'increase casino payout slightly' },
      { id: 'megaJackpot', name: 'Mega Jackpot', basePrice: 1000, priceMul: 3.0, desc: 'increases triple payout and special 7 reward' }
    ];

    // ===== Persistence =====
    function save() { localStorage.setItem(SAVE_KEY, JSON.stringify(state)); }
    function load(){
      try {
        const s = JSON.parse(localStorage.getItem(SAVE_KEY));
        if (s) state = Object.assign(state, s);
      } catch(e){}
    }

    load(); // load on start

    // ensure derived values
    function applyUpgradesToStats(){
      state.perClick = 1 + (state.upgrades.clickPower || 0) * 1;
      state.autoPerSec = (state.upgrades.autoWorker || 0) * 2;
    }
    applyUpgradesToStats();

    // ===== Audio =====
    const AudioCtx = (window.AudioContext || window.webkitAudioContext);
    const audioCtx = AudioCtx ? new AudioCtx() : null;
    function beep(freq=440, time=80, type='sine', vol=0.06){
      if(!audioCtx) return;
      const o = audioCtx.createOscillator();
      const g = audioCtx.createGain();
      o.type = type; o.frequency.value = freq;
      g.gain.value = vol;
      o.connect(g); g.connect(audioCtx.destination);
      o.start();
      setTimeout(()=> o.stop(), time);
    }
    function soundTick(){ beep(700,50,'square',0.03); }
    function soundWin(){ beep(880,90,'sine',0.07); setTimeout(()=>beep(1100,120,'sine',0.08),110); }
    function soundLose(){ beep(200,200,'sawtooth',0.09); }

    // ===== UI refs =====
    const elems = {
      balance: document.getElementById('balance'),
      perClick: document.getElementById('perClick'),
      incomeLabel: document.getElementById('incomeLabel'),
      totalEarned: document.getElementById('totalEarned'),
      autoRate: document.getElementById('autoRate'),
      bigMoney: document.getElementById('bigMoney'),
      moneyBtn: document.getElementById('moneyBtn'),
      saveBtn: document.getElementById('saveBtn'),
      resetBtn: document.getElementById('resetBtn'),
      exportBtn: document.getElementById('exportBtn'),
      importBtn: document.getElementById('importBtn'),
      shopGrid: document.getElementById('shopGrid'),
      casinoMoney: document.getElementById('casinoMoney'),
      casinoInfo: document.getElementById('casinoInfo'),
      slotsContainer: document.getElementById('slotsContainer'),
      slotEls: [document.getElementById('slot1'), document.getElementById('slot2'), document.getElementById('slot3')],
      betInput: document.getElementById('betInput'),
      gambleBtn: document.getElementById('gambleBtn'),
      maxBetBtn: document.getElementById('maxBetBtn'),
      activateBigBet: document.getElementById('activateBigBet'),
      purchaseMega: document.getElementById('purchaseMega'),
      bigBetLabel: document.getElementById('bigBetLabel'),
      infoPerClick: document.getElementById('infoPerClick'),
      infoAuto: document.getElementById('infoAuto'),
      infoTotal: document.getElementById('infoTotal'),
      tabs: {
        money: document.getElementById('tabMoney'),
        income: document.getElementById('tabIncome'),
        upgrades: document.getElementById('tabUpgrades'),
        casino: document.getElementById('tabCasino'),
        help: document.getElementById('tabHelp')
      },
      panes: {
        money: document.getElementById('moneyTab'),
        income: document.getElementById('incomeTab'),
        upgrades: document.getElementById('upgradesTab'),
        casino: document.getElementById('casinoTab'),
        help: document.getElementById('helpTab')
      }
    };

    // ===== Helpers =====
    function fmt(n){
      if(n >= 1e9) return (n/1e9).toFixed(2) + "B";
      if(n >= 1e6) return (n/1e6).toFixed(2) + "M";
      if(n >= 1e3) return (n/1e3).toFixed(1) + "k";
      return n.toLocaleString();
    }

    function getUpgradePrice(item){
      const lvl = state.upgrades[item.id] || 0;
      return Math.floor(item.basePrice * Math.pow(item.priceMul, lvl));
    }

    // calculate casino multipliers
    function getTripleMultiplier(){
      const boost = state.upgrades.casinoBoost || 0;
      const mega = state.upgrades.megaJackpot || 0;
      return BASE_TRIPLE + (boost * 2) + (mega * 5);
    }
    function getPairMultiplier(){
      const boost = state.upgrades.casinoBoost || 0;
      return BASE_PAIR + (boost * 0.5);
    }

    // weighted symbol generation (mega jackpot increases chance of rare '7')
    function buildSymbolWeights(){
      // base weights: common items higher, 7 rare
      const base = [18,16,12,8,6,4]; // corresponding to SYMBOLS
      const mega = state.upgrades.megaJackpot || 0;
      if(mega > 0){
        // increase chance of 7 slightly per mega level
        base[5] += mega * 2;
        // normalize by slightly reducing others
        for(let i=0;i<5;i++) base[i] = Math.max(5, base[i] - Math.floor(mega*0.4));
      }
      return base;
    }
    function weightedPick(weights){
      const sum = weights.reduce((a,b)=>a+b,0);
      let r = Math.floor(Math.random() * sum);
      for(let i=0;i<weights.length;i++){
        if(r < weights[i]) return i;
        r -= weights[i];
      }
      return weights.length-1;
    }

    // ===== Render =====
    function render(){
      applyUpgradesToStats();
      elems.balance.textContent = fmt(state.balance) + " ‚Ç´";
      elems.perClick.textContent = "Click: " + fmt(state.perClick) + " ‚Ç´";
      elems.incomeLabel.textContent = "$" + fmt(state.perClick);
      elems.totalEarned.textContent = fmt(state.totalEarned);
      elems.autoRate.textContent = state.autoPerSec;
      elems.bigMoney.textContent = "$" + fmt(state.balance);
      elems.casinoMoney.textContent = "$" + fmt(state.balance);
      elems.infoPerClick.textContent = fmt(state.perClick);
      elems.infoAuto.textContent = fmt(state.autoPerSec);
      elems.infoTotal.textContent = fmt(state.totalEarned);

      // shop UI
      elems.shopGrid.innerHTML = '';
      SHOP.forEach(item=>{
        const lvl = state.upgrades[item.id] || 0;
        const price = getUpgradePrice(item);
        const div = document.createElement('div');
        div.className = 'item';
        div.innerHTML = `<h4>${item.name} (Lv ${lvl})</h4>
          <div style="color:var(--muted); font-size:13px">${item.desc}</div>
          <div style="display:flex; justify-content:space-between; align-items:center; margin-top:8px">
            <div style="color:var(--muted); font-size:14px">Gi√°: ${fmt(price)} ‚Ç´</div>
            <button ${state.balance < price ? 'disabled' : ''} data-id="${item.id}">Mua</button>
          </div>`;
        elems.shopGrid.appendChild(div);
        div.querySelector('button').addEventListener('click', ()=> buyUpgrade(item.id));
      });

      // BigBet label
      const now = Date.now();
      if(state.bigBet.active && state.bigBet.activeUntil > now){
        elems.bigBetLabel.textContent = `ON (${Math.ceil((state.bigBet.activeUntil - now)/1000)}s)`;
      } else {
        elems.bigBetLabel.textContent = 'OFF';
      }

      // update casino info
      elems.casinoInfo.textContent = `Rules: 3 gi·ªëng -> x${getTripleMultiplier().toFixed(1)} (triple7 special), 2 gi·ªëng -> x${getPairMultiplier().toFixed(2)}. Max bet: ${fmt(MAX_BET_GLOBAL)}. Mega level: ${state.upgrades.megaJackpot || 0}`;
    }

    render();

    // ===== Actions: clicker, auto earn =====
    elems.moneyBtn.addEventListener('click', ()=>{
      state.balance += state.perClick;
      state.totalEarned += state.perClick;
      playClickSound();
      render();
    });

    function playClickSound(){ if(audioCtx) beep(750,60,'sine',0.04); }

    setInterval(()=>{
      if(state.autoPerSec > 0){
        state.balance += state.autoPerSec;
        state.totalEarned += state.autoPerSec;
        render();
      }
    }, 1000);

    // ===== Shop & Upgrades =====
    function buyUpgrade(id){
      const item = SHOP.find(s=>s.id===id);
      const price = getUpgradePrice(item);
      if(state.balance < price) return alert('Kh√¥ng ƒë·ªß ti·ªÅn!');
      state.balance -= price;
      state.upgrades[id] = (state.upgrades[id]||0) + 1;
      // apply immediate effects
      applyUpgradesToStats();
      save(); render();
    }

    // Big Bet ability
    elems.activateBigBet.addEventListener('click', ()=>{
      const now = Date.now();
      if(state.bigBet.active && state.bigBet.activeUntil > now) return alert('Big Bet ƒëang ho·∫°t ƒë·ªông!');
      if(state.bigBet.cooldownUntil && state.bigBet.cooldownUntil > now) return alert(`Big Bet ƒëang cooldown ${Math.ceil((state.bigBet.cooldownUntil-now)/1000)}s`);
      if(state.balance < BIG_BET_COST) return alert('Kh√¥ng ƒë·ªß ti·ªÅn k√≠ch ho·∫°t Big Bet!');
      // pay cost, activate
      state.balance -= BIG_BET_COST;
      state.bigBet.active = true;
      state.bigBet.activeUntil = Date.now() + BIG_BET_DUR*1000;
      state.bigBet.cooldownUntil = Date.now() + (BIG_BET_DUR + BIG_BET_CD)*1000;
      save(); render();
      // schedule deactivate
      setTimeout(()=> { state.bigBet.active = false; save(); render(); }, BIG_BET_DUR*1000);
    });

    // Purchase Mega directly (small shortcut)
    elems.purchaseMega.addEventListener('click', ()=>{
      const item = SHOP.find(s=>s.id==='megaJackpot');
      const price = getUpgradePrice(item);
      if(state.balance < price) return alert('Kh√¥ng ƒë·ªß ti·ªÅn mua Mega Jackpot!');
      state.balance -= price;
      state.upgrades.megaJackpot = (state.upgrades.megaJackpot||0) + 1;
      save(); render();
    });

    // ===== Casino: weighted slots, payouts, animations =====
    let spinning = false;
    function animateSlots(finalIdxs, duration=1000){
      const interval = 60;
      const steps = Math.floor(duration/interval);
      let step = 0;
      elems.slotsContainer.classList.remove('shake');
      elems.slotEls.forEach(el=> el.classList.remove('win','lose'));
      const timers = [];
      elems.slotEls.forEach((el, idx)=>{
        const stopAt = Math.floor(steps * (0.6 + idx*0.18));
        const t = setInterval(()=>{
          const sym = SYMBOLS[Math.floor(Math.random()*SYMBOLS.length)];
          el.textContent = sym;
          if(audioCtx) soundTick();
        }, interval);
        timers.push({timer:t, stopAt, idx});
      });
      const master = setInterval(()=>{
        step++;
        timers.forEach(obj=>{
          if(step >= obj.stopAt){
            clearInterval(obj.timer);
            elems.slotEls[obj.idx].textContent = SYMBOLS[finalIdxs[obj.idx]];
          }
        });
        if(step > steps + 1){
          clearInterval(master);
          spinning = false;
        }
      }, interval);
    }

    elems.gambleBtn.addEventListener('click', ()=> doGamble());
    function doGamble(){
      if(spinning) return;
      let bet = Math.floor(Number(elems.betInput.value) || 0);
      if(!bet || bet <= 0) { alert('Nh·∫≠p bet >=1'); return; }
      if(bet > state.balance) { alert('Kh√¥ng ƒë·ªß ti·ªÅn c∆∞·ª£c'); return; }
      const maxAllowed = Math.min(MAX_BET_GLOBAL, Math.floor(state.balance));
      if(bet > maxAllowed) { alert('Bet v∆∞·ª£t gi·ªõi h·∫°n: ' + fmt(maxAllowed)); return; }

      // deduct bet immediately
      state.balance -= bet;
      render();

      // pick symbols with weights
      const weights = buildSymbolWeights();
      const a = weightedPick(weights);
      const b = weightedPick(weights);
      const c = weightedPick(weights);

      spinning = true;
      elems.gambleBtn.disabled = true;
      animateSlots([a,b,c], 1200);

      setTimeout(()=>{
        const symA = SYMBOLS[a], symB = SYMBOLS[b], symC = SYMBOLS[c];
        let payout = 0;
        // compute multipliers (consider BigBet active)
        let tripleMult = getTripleMultiplier();
        let pairMult = getPairMultiplier();
        if(state.bigBet.active && state.bigBet.activeUntil > Date.now()){
          tripleMult *= BIG_BET_MULT;
          pairMult *= BIG_BET_MULT;
        }
        // special triple 7
        if(a === b && b === c){
          // triple
          payout = Math.floor(bet * tripleMult);
          // extra boost if triple 7
          if(symA === '7Ô∏è‚É£'){
            payout = Math.floor(payout * (1 + (state.upgrades.megaJackpot || 0) * MEGA_7_BONUS));
            elems.casinoInfo.textContent = `JACKPOT! Triple 7Ô∏è‚É£! B·∫°n th·∫Øng ${fmt(payout)}!`;
          } else {
            elems.casinoInfo.textContent = `Triple ${symA}! B·∫°n th·∫Øng ${fmt(payout)}!`;
          }
          elems.slotEls.forEach(el=> el.classList.add('win'));
          if(audioCtx) soundWin();
        } else if(a === b || a === c || b === c){
          payout = Math.floor(bet * pairMult);
          elems.casinoInfo.textContent = `Pair! B·∫°n th·∫Øng ${fmt(payout)}!`;
          elems.slotEls.forEach(el=> el.classList.add('win'));
          if(audioCtx) soundWin();
        } else {
          elems.casinoInfo.textContent = `B·∫°n thua ${fmt(bet)}.`;
          elems.slotsContainer.classList.add('shake');
          elems.slotEls.forEach(el=> el.classList.add('lose'));
          if(audioCtx) soundLose();
        }

        // apply payout and stats
        state.balance += payout;
        if(payout > 0) state.totalEarned += payout;
        spinning = false;
        elems.gambleBtn.disabled = false;
        save();
        render();
      }, 1300);
    }

    elems.maxBetBtn.addEventListener('click', ()=>{
      const maxAllowed = Math.min(MAX_BET_GLOBAL, Math.floor(state.balance));
      elems.betInput.value = Math.max(1, maxAllowed);
    });

    // ===== Export / Import Save =====
    elems.exportBtn.addEventListener('click', ()=>{
      const data = JSON.stringify(state);
      const blob = new Blob([data], {type:'application/json'});
      const url = URL.createObjectURL(blob);
      const a = document.createElement('a');
      a.href = url; a.download = 'mmg-save.json'; a.click();
      URL.revokeObjectURL(url);
    });
    elems.importBtn.addEventListener('click', ()=>{
      const input = document.createElement('input');
      input.type = 'file'; input.accept = '.json,application/json';
      input.onchange = e => {
        const f = e.target.files[0];
        if(!f) return;
        const reader = new FileReader();
        reader.onload = ev => {
          try {
            const obj = JSON.parse(ev.target.result);
            state = obj;
            applyUpgradesToStats();
            save(); render();
            alert('Import th√†nh c√¥ng!');
          } catch(err){ alert('File kh√¥ng h·ª£p l·ªá'); }
        };
        reader.readAsText(f);
      };
      input.click();
    });

    // ===== Save/Reset UI =====
    elems.saveBtn.addEventListener('click', ()=> { save(); alert('ƒê√£ l∆∞u!'); });
    elems.resetBtn.addEventListener('click', ()=> {
      if(confirm('Reset to√†n b·ªô d·ªØ li·ªáu v·ªÅ m·∫∑c ƒë·ªãnh?')){
        localStorage.removeItem(SAVE_KEY);
        state = { balance: 500, perClick:1, autoPerSec:0, totalEarned:0, upgrades:{clickPower:0,autoWorker:0,casinoBoost:0,megaJackpot:0}, bigBet:{active:false,cooldownUntil:0,activeUntil:0} };
        applyUpgradesToStats(); save(); render();
      }
    });

    // ===== Tabs logic =====
    function showTab(name){
      Object.keys(elems.panes).forEach(k=> elems.panes[k].style.display = (k===name)?'block':'none');
      Object.keys(elems.tabs).forEach(k=> elems.tabs[k].classList.toggle('active', k===name));
    }
    elems.tabs.money.addEventListener('click', ()=> showTab('money'));
    elems.tabs.income.addEventListener('click', ()=> showTab('income'));
    elems.tabs.upgrades.addEventListener('click', ()=> showTab('upgrades'));
    elems.tabs.casino.addEventListener('click', ()=> showTab('casino'));
    elems.tabs.help.addEventListener('click', ()=> showTab('help'));
    document.getElementById('casinoBack').addEventListener('click', ()=> showTab('money'));

    // ===== Periodic save =====
    setInterval(save, 8000);

    // ===== Final render =====
    render();

    // ===== Notes for customization (inside the code) =====
    // - Thay ƒë·ªïi payout: ch·ªânh BASE_TRIPLE, BASE_PAIR, MEGA_7_BONUS, v√† logic Big Bet
    // - Th√™m symbol: ch·ªânh SYMBOLS v√† base weights trong buildSymbolWeights()
    // - Th√™m upgrades: th√™m m·ª•c v√†o SHOP array. Gi√° v√† tƒÉng hi·ªáu ·ª©ng do b·∫°n quy·∫øt ƒë·ªãnh.

  </script>
</body>
</html>
