<!doctype html>
<html lang="vi">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>Flappy Bird - Mini (HTML + JS)</title>
<style>
  :root{
    --width: 420px;
    --height: 640px;
  }
  html,body{
    height:100%;
    margin:0;
    display:flex;
    align-items:center;
    justify-content:center;
    /* d√πng snippet y√™u c·∫ßu */
    font-family: system-ui, -apple-system, "Segoe UI", Roboto, "Noto Sans", "Helvetica Neue", Arial;
    background: linear-gradient(#87CEEB,#bfe7ff 60%);
  }

  #wrap{
    width:var(--width);
    max-width:96vw;
    box-shadow:0 12px 30px rgba(0,0,0,0.25);
    border-radius:12px;
    overflow:hidden;
    background:linear-gradient(#70c5ce,#5aa9b7);
    position:relative;
  }

  canvas{
    display:block;
    width:100%;
    height:auto;
    background:transparent;
  }

  .ui{
    position:absolute;
    left:0;right:0;
    top:0;
    padding:12px;
    display:flex;
    justify-content:space-between;
    color:#fff;
    font-weight:700;
    pointer-events:none;
    text-shadow:0 1px 0 rgba(0,0,0,0.4);
  }

  #overlay{
    position:absolute;
    inset:0;
    display:flex;
    align-items:center;
    justify-content:center;
    flex-direction:column;
    gap:10px;
    z-index:20;
    background:linear-gradient(rgba(0,0,0,0.15), rgba(0,0,0,0.12));
    pointer-events:auto;
  }

  .btn{
    background:rgba(255,255,255,0.12);
    border:1px solid rgba(255,255,255,0.18);
    color:#fff;
    padding:10px 14px;
    border-radius:8px;
    font-weight:800;
    cursor:pointer;
  }

  #hint{
    font-size:13px;
    color:#f7fb;
    opacity:0.95;
    text-align:center;
    max-width:86%;
  }

  #footer{
    font-size:12px;
    color:rgba(255,255,255,0.9);
    text-align:center;
    padding:8px 12px;
  }

  @media (max-width:420px){
    :root{ --width:360px; --height:640px; }
  }
</style>
</head>
<body>
  <div id="wrap" role="application" aria-label="Flappy Bird mini">
    <canvas id="c" width="420" height="640" aria-hidden="false"></canvas>

    <div class="ui" aria-hidden="true">
      <div>ƒêi·ªÉm: <span id="score">0</span></div>
      <div>Cao nh·∫•t: <span id="hi">0</span></div>
    </div>

    <div id="overlay" role="dialog" aria-modal="true">
      <h2 style="margin:0;color:#fff">Flappy Mini</h2>
      <div id="hint">Nh·∫•n/Ch·∫°m ƒë·ªÉ bay. Tr√°nh ·ªëng. ƒêi·ªÉm tƒÉng khi v∆∞·ª£t ·ªëng.</div>
      <div style="display:flex;gap:10px">
        <button id="startBtn" class="btn">B·∫Øt ƒë·∫ßu</button>
        <button id="easyBtn" class="btn">Ch∆°i nh·∫π</button>
      </div>
      <div style="font-size:12px;color:#eef;opacity:0.9">Ph√≠m: Space / ‚Üë</div>
    </div>

    <div id="footer">M√†n h√¨nh c·∫£m ·ª©ng: ch·∫°m ƒë·ªÉ nh·∫£y</div>
  </div>

<script>
/*
  Flappy Bird mini, single-file.
  Controls:
    - Click/tap or Space / ArrowUp to flap
    - Start/Easy buttons to begin
  Features:
    - Pipes with gap
    - Score when passing pipes
    - Highscore stored in localStorage
    - Mobile friendly (pointer events)
*/

// Canvas
const canvas = document.getElementById('c');
const ctx = canvas.getContext('2d', { alpha: false });
const W = canvas.width, H = canvas.height;

// UI
const overlay = document.getElementById('overlay');
const scoreEl = document.getElementById('score');
const hiEl = document.getElementById('hi');
const startBtn = document.getElementById('startBtn');
const easyBtn = document.getElementById('easyBtn');

let high = parseInt(localStorage.getItem('flappy_hi') || '0', 10);
hiEl.textContent = high;

let running = false;
let gravity = 0.5;
let flapStrength = -9;
let speed = 2.6;
let pipeGap = 150;
let pipeWidth = 78;
let pipeSpawnRate = 90; // frames
let frame = 0;
let pipes = [];
let score = 0;

// Bird state
const bird = {
  x: 110,
  y: H/2 - 10,
  w: 34,
  h: 26,
  vy: 0,
  rot: 0,
  alive: true
};

// Input
let wantFlap = false;
function flap(){
  wantFlap = true;
}
canvas.addEventListener('pointerdown', (e)=>{ flap(); e.preventDefault(); }, { passive:false });
window.addEventListener('keydown', (e)=>{
  if(e.code === 'Space' || e.code === 'ArrowUp') { flap(); e.preventDefault(); }
  if(e.code === 'KeyP') paused = !paused;
});

// Buttons
startBtn.addEventListener('click', ()=>start(false));
easyBtn.addEventListener('click', ()=>start(true));

let paused = false;
function start(easy=false){
  // reset
  pipes = [];
  frame = 0;
  score = 0;
  bird.y = H/2 - 10;
  bird.vy = 0;
  bird.rot = 0;
  bird.alive = true;
  running = true;
  paused = false;
  if(easy){
    gravity = 0.4;
    flapStrength = -8;
    speed = 1,4;
    pipeGap = 170;
    pipeSpawnRate = 100;
  } else {
    gravity = 1,5;
    flapStrength = -9;
    speed = 2;
    pipeGap = 150;
    pipeSpawnRate = 90;
  }
  overlay.style.display = 'none';
  requestAnimationFrame(loop);
}

function spawnPipe(){
  const minTop = 40;
  const maxTop = H - pipeGap - 120;
  const top = Math.floor(Math.random() * (maxTop - minTop + 1)) + minTop;
  pipes.push({
    x: W + 10,
    top: top,
    bottom: top + pipeGap,
    passed: false
  });
}

// collision: AABB
function rectsOverlap(ax,ay,aw,ah, bx,by,bw,bh){
  return !(ax+aw < bx || ax > bx+bw || ay+ah < by || ay > by+bh);
}

// draw helpers
function drawBackground(){
  // sky gradient
  const g = ctx.createLinearGradient(0,0,0,H);
  g.addColorStop(0,'#70c5ce');
  g.addColorStop(1,'#5aa9b7');
  ctx.fillStyle = g;
  ctx.fillRect(0,0,W,H);

  // ground
  ctx.fillStyle = '#ded085';
  ctx.fillRect(0, H - 80, W, 80);
  ctx.fillStyle = '#c9b36a';
  ctx.fillRect(0, H - 80, W, 6);
}

function drawPipe(p){
  ctx.fillStyle = '#2f7f3f';
  // top pipe
  ctx.fillRect(p.x, 0, pipeWidth, p.top);
  // bottom pipe
  ctx.fillRect(p.x, p.bottom, pipeWidth, H - p.bottom - 80);
  // caps
  ctx.fillStyle = '#2b6f37';
  ctx.fillRect(p.x - 6, p.top - 12, pipeWidth + 12, 12);
  ctx.fillRect(p.x - 6, p.bottom, pipeWidth + 12, 12);
}

function drawBird(){
  ctx.save();
  ctx.translate(bird.x + bird.w/2, bird.y + bird.h/2);
  ctx.rotate(bird.rot * Math.PI/180);
  // body
  ctx.fillStyle = '#ffdd57';
  roundRect(ctx, -bird.w/2, -bird.h/2, bird.w, bird.h, 6);
  ctx.fill();
  // wing (simple)
  ctx.fillStyle = '#ffb400';
  ctx.fillRect(-6, -2, 10, 6);
  // eye
  ctx.fillStyle = '#111';
  ctx.beginPath(); ctx.arc(6, -6, 3.5, 0, Math.PI*2); ctx.fill();
  ctx.restore();
}

function roundRect(ctx,x,y,w,h,r=6){
  ctx.beginPath();
  ctx.moveTo(x+r,y);
  ctx.arcTo(x+w,y,x+w,y+h,r);
  ctx.arcTo(x+w,y+h,x,y+h,r);
  ctx.arcTo(x,y+h,x,y,r);
  ctx.arcTo(x,y,x+w,y,r);
  ctx.closePath();
}

// sounds (tiny beep using WebAudio)
let audioCtx;
function beep(freq=400, time=0.06, vol=0.02){
  try{
    if(!audioCtx) audioCtx = new (window.AudioContext || window.webkitAudioContext)();
    const o = audioCtx.createOscillator();
    const g = audioCtx.createGain();
    o.type = 'sine';
    o.frequency.value = freq;
    g.gain.value = vol;
    o.connect(g); g.connect(audioCtx.destination);
    o.start();
    o.stop(audioCtx.currentTime + time);
  }catch(e){}
}

// main loop
function loop(){
  if(!running) return;
  if(paused){ requestAnimationFrame(loop); return; }

  frame++;

  // spawn pipes
  if(frame % pipeSpawnRate === 0){
    spawnPipe();
  }

  // update pipes
  for(let i = pipes.length - 1; i >= 0; i--){
    const p = pipes[i];
    p.x -= speed + (score * 0.002);
    // score when passed
    if(!p.passed && p.x + pipeWidth < bird.x){
      p.passed = true;
      score++;
      scoreEl.textContent = score;
      beep(700,0.04,0.03);
    }
    if(p.x + pipeWidth < -40) pipes.splice(i,1);
  }

  // bird physics
  if(wantFlap && bird.alive){
    bird.vy = flapStrength;
    bird.rot = -25;
    wantFlap = false;
    beep(900,0.03,0.04);
  }
  bird.vy += gravity;
  bird.y += bird.vy;
  // rotate gradually down
  bird.rot += Math.min(6, (bird.vy + 1.5) * 2);
  if(bird.rot > 100) bird.rot = 85;

  // ground collision
  if(bird.y + bird.h > H - 80){
    bird.y = H - 80 - bird.h;
    bird.alive = false;
    hit();
    return;
  }
  if(bird.y < 0){
    bird.y = 0;
    bird.vy = 0;
  }

  // collision with pipes
  const bx = bird.x, by = bird.y, bw = bird.w, bh = bird.h;
  for(const p of pipes){
    // top pipe rect: p.x, 0, pipeWidth, p.top
    // bottom pipe rect: p.x, p.bottom, pipeWidth, H - p.bottom - 80
    if(rectsOverlap(bx,by,bw,bh, p.x, 0, pipeWidth, p.top) ||
       rectsOverlap(bx,by,bw,bh, p.x, p.bottom, pipeWidth, H - p.bottom)){
      bird.alive = false;
      hit();
      return;
    }
  }

  // draw
  ctx.clearRect(0,0,W,H);
  drawBackground();
  // pipes
  for(const p of pipes) drawPipe(p);

  // foreground grass (parallax)
  ctx.fillStyle = 'rgba(0,0,0,0.06)';
  for(let i=0;i<6;i++){
    ctx.fillRect((i*70 + (frame*0.3)%70), H - 86, 44, 6);
  }

  // bird
  drawBird();

  // loop
  requestAnimationFrame(loop);
}

function hit(){
  // play sound and show overlay
  beep(140,0.25,0.06);
  running = false;
  overlay.style.display = 'flex';
  document.getElementById('hint').textContent = `B·∫°n thua! ƒêi·ªÉm: ${score}`;
  // highscore
  if(score > high){
    high = score;
    localStorage.setItem('flappy_hi', high);
    document.getElementById('hint').textContent += ' üéâ M·ªõi!';
  }
  hiEl.textContent = high;
  scoreEl.textContent = score;
}

// initial draw
(function init(){
  ctx.fillStyle = '#70c5ce';
  ctx.fillRect(0,0,W,H);
  ctx.fillStyle = '#fff';
  ctx.font = '18px system-ui';
  ctx.fillText('Nh·∫•n B·∫Øt ƒë·∫ßu ƒë·ªÉ ch∆°i', 18, 26);
  scoreEl.textContent = 0;
})();

// prevent page scroll on touch
canvas.addEventListener('touchmove', (e)=>{ e.preventDefault(); }, { passive:false });

</script>
</body>
</html>  
